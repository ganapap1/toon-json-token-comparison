<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON vs TOON - Token Comparison Demo</title>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js for code syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github.min.css"
    />
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #b9bab9;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1450px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .controls {
        padding: 30px;
        background: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
      }

      .control-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .control-group {
        flex: 1;
        min-width: 250px;
      }

      .control-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
      }

      .control-group select,
      .control-group input,
      .control-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #dee2e6;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .control-group select:focus,
      .control-group input:focus,
      .control-group textarea:focus {
        outline: none;
        border-color: #047857;
      }

      .control-group textarea {
        resize: vertical;
        font-family: "Courier New", monospace;
        min-height: 150px;
      }

      .button-group {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      button {
        padding: 14px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        flex: 1;
      }

      button.primary {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        color: white;
      }

      button.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(4, 120, 87, 0.4);
      }

      button.secondary {
        background: #6c757d;
        color: white;
      }

      button.secondary:hover {
        background: #5a6268;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #047857;
        font-size: 18px;
        font-weight: 600;
      }

      .loading::after {
        content: "...";
        animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: ".";
        }
        40% {
          content: "..";
        }
        60% {
          content: "...";
        }
        80%,
        100% {
          content: "";
        }
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 6px;
        margin: 20px 30px;
        border: 1px solid #f5c6cb;
      }

      .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
      }

      .column {
        display: flex;
        flex-direction: column;
        gap: 20px;
        min-width: 0;
      }

      .card {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        border: 2px solid #e9ecef;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #dee2e6;
      }

      .card-title {
        font-size: 1.3em;
        font-weight: 700;
        color: #212529;
      }

      .card-title.json {
        color: #e83e8c;
      }

      .card-title.toon {
        color: #28a745;
      }

      .stats {
        display: flex;
        gap: 15px;
        font-size: 0.85em;
        color: #6c757d;
      }

      .stat-item {
        background: white;
        padding: 5px 10px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }

      .stat-label {
        font-weight: 600;
      }

      .content-box {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        font-family: "Courier New", monospace;
        font-size: 13px;
        line-height: 1.6;
      }

      .content-box pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      /* Horizontal scrolling for TOON format only */
      #toonContent pre {
        white-space: pre;
        word-wrap: normal;
        overflow-x: auto;
      }

      .response-box {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
        line-height: 1.8;
      }

      .response-box h1,
      .response-box h2,
      .response-box h3 {
        margin-top: 20px;
        margin-bottom: 10px;
        color: #212529;
      }

      .response-box h1 {
        font-size: 1.8em;
      }
      .response-box h2 {
        font-size: 1.5em;
      }
      .response-box h3 {
        font-size: 1.2em;
      }

      .response-box ul,
      .response-box ol {
        margin-left: 25px;
        margin-bottom: 15px;
      }

      .response-box p {
        margin-bottom: 15px;
      }

      .response-box code {
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
      }

      .response-box pre code {
        display: block;
        padding: 15px;
        overflow-x: auto;
      }

      .summary {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        margin-top: 10px;
      }

      .summary h2 {
        margin-bottom: 20px;
        font-size: 1.8em;
        text-align: center;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .summary-item {
        background: rgba(26, 24, 24, 0.15);
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        backdrop-filter: blur(10px);
      }

      .summary-label {
        font-size: 0.9em;
        opacity: 0.9;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .summary-value {
        font-size: 2em;
        font-weight: 700;
      }

      .summary-value.savings {
        color: #4ade80;
        font-size: 2.5em;
      }

      /* Plain Language Summary Card */
      .plain-summary-card {
        grid-column: 1 / -1;
        background: linear-gradient(
          135deg,
          rgba(4, 120, 87, 0.08) 0%,
          rgba(6, 95, 70, 0.08) 100%
        );
        border: 2px solid rgba(4, 120, 87, 0.2);
        border-radius: 12px;
        padding: 25px 30px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(4, 120, 87, 0.1);
      }

      .plain-summary-title {
        font-size: 1.4em;
        font-weight: 700;
        color: #047857;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        user-select: none;
        transition: color 0.2s;
      }

      .plain-summary-title:hover {
        color: #065f46;
      }

      .collapse-icon {
        font-size: 0.8em;
        transition: transform 0.3s ease;
        color: #047857;
      }

      .collapse-icon.collapsed {
        transform: rotate(-90deg);
      }

      .plain-summary-text {
        font-size: 1.1em;
        line-height: 1.7;
        color: #495057;
        margin: 0;
        font-weight: 500;
        overflow: hidden;
        transition: max-height 0.3s ease, opacity 0.3s ease,
          margin-top 0.3s ease;
        max-height: 2000px;
        opacity: 1;
      }

      .plain-summary-text.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: 0;
      }

      .plain-summary-highlight {
        color: #047857;
        font-weight: 700;
      }

      /* Enhanced Summary Items */
      .summary-item {
        position: relative;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .summary-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .summary-label {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .summary-description {
        font-size: 0.85em;
        line-height: 1.5;
        margin-top: 12px;
        opacity: 0.85;
        font-weight: 400;
        text-transform: none;
        letter-spacing: normal;
        color: rgba(255, 255, 255, 0.95);
      }

      /* Value Color Coding */
      .summary-value.amber {
        color: #fbbf24;
        font-size: 2.5em;
        font-weight: 700;
      }

      .summary-value.positive {
        color: #4ade80;
        font-size: 2.5em;
        font-weight: 700;
      }

      .summary-value.negative {
        color: #f87171;
        font-size: 2.5em;
        font-weight: 700;
      }

      .summary-value.neutral {
        color: rgba(255, 255, 255, 0.9);
        font-size: 2.5em;
        font-weight: 700;
      }

      /* Context Text for Values */
      .value-context {
        font-size: 0.5em;
        display: block;
        margin-top: 4px;
        opacity: 0.75;
        font-weight: 400;
      }

      /* Tooltip Icon */
      .tooltip-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: rgba(255, 255, 255, 0.25);
        border-radius: 50%;
        font-size: 0.85em;
        cursor: help;
        transition: all 0.2s;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .tooltip-icon:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
      }

      /* Tooltip Container */
      .tooltip-container {
        position: fixed;
        z-index: 10000;
        max-width: 320px;
        background: #2d3748;
        color: white;
        padding: 14px 16px;
        border-radius: 8px;
        font-size: 0.9em;
        line-height: 1.6;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        pointer-events: none;
        animation: tooltipFadeIn 0.2s ease-out;
      }

      @keyframes tooltipFadeIn {
        from {
          opacity: 0;
          transform: translateY(-5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tooltip-content {
        margin: 0;
      }

      .tooltip-content strong {
        display: block;
        margin-bottom: 6px;
        color: #4ade80;
        font-size: 1.05em;
      }

      .tooltip-content p {
        margin: 0 0 8px 0;
      }

      .tooltip-content p:last-child {
        margin-bottom: 0;
      }

      .tooltip-content .tooltip-range {
        font-style: italic;
        color: #a0aec0;
        font-size: 0.95em;
      }

      /* Mobile Responsive - Tooltip Adaptations */
      @media (max-width: 768px) {
        .tooltip-icon {
          width: 20px;
          height: 20px;
          font-size: 0.9em;
        }

        .tooltip-container {
          max-width: 280px;
          font-size: 0.85em;
        }

        .plain-summary-card {
          padding: 20px;
        }

        .plain-summary-text {
          font-size: 1em;
        }

        .summary-description {
          font-size: 0.8em;
        }

        .summary-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .summary-value {
          font-size: 2em !important;
        }

        .summary-value.savings,
        .summary-value.amber,
        .summary-value.positive {
          font-size: 2em !important;
        }
      }

      .footer {
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-top: 2px solid #e9ecef;
        color: #6c757d;
      }

      .footer a {
        color: #047857;
        text-decoration: none;
        font-weight: 600;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      @media (max-width: 1200px) {
        .comparison-grid {
          grid-template-columns: 1fr;
        }

        .summary {
          grid-column: 1;
        }
      }

      .info-box {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
      }

      .info-box strong {
        display: block;
        margin-bottom: 5px;
      }

      .load-demo-btn {
        background: #17a2b8;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 10px;
      }

      .load-demo-btn:hover {
        background: #138496;
      }

      .ai-assessment {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, #fef9e7 0%, #fef5e7 100%);
        border: 2px solid #f9e79f;
        border-radius: 8px;
        padding: 25px;
        margin: 20px 0;
      }

      .ai-assessment h3 {
        color: #9c640c;
        margin-bottom: 15px;
        font-size: 1.4em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .ai-assessment h3::before {
        content: "ðŸ¤–";
        font-size: 1.2em;
      }

      .ai-assessment-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
      }

      .assessment-item {
        background: white;
        border: 1px solid #f9e79f;
        border-radius: 6px;
        padding: 15px;
      }

      .assessment-item h4 {
        color: #9c640c;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .assessment-item.json h4 {
        color: #e83e8c;
      }

      .assessment-item.toon h4 {
        color: #28a745;
      }

      .assessment-metric {
        margin: 10px 0;
        padding: 8px 12px;
        background: #fef9e7;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .assessment-label {
        font-weight: 600;
        color: #6c757d;
        font-size: 0.9em;
      }

      .assessment-value {
        font-weight: 700;
        font-size: 1.1em;
      }

      .assessment-value.excellent {
        color: #28a745;
      }

      .assessment-value.good {
        color: #5cb85c;
      }

      .assessment-value.moderate {
        color: #f0ad4e;
      }

      .ai-insight {
        margin-top: 15px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.7);
        border-left: 4px solid #f39c12;
        border-radius: 4px;
        font-style: italic;
        color: #555;
        line-height: 1.6;
      }

      @media (max-width: 1200px) {
        .ai-assessment-content {
          grid-template-columns: 1fr;
        }
      }

      /* Hide data input and prompt template sections */
      #dataInput,
      #promptTemplate,
      label[for="dataInput"],
      label[for="promptTemplate"] {
        display: none !important;
      }

      /* Keep the load demo button visible */
      .load-demo-btn {
        display: inline-block !important;
        margin-top: 0 !important;
      }

      /* Data load status message */
      .data-load-status {
        display: inline-block;
        margin-left: 20px;
        color: #28a745;
        font-weight: 600;
        font-size: 14px;
      }

      /* Show control rows but hide only the textareas inside */
      .control-row {
        display: flex !important;
      }

      /* Orientation Impact Button */
      .orientation-info-btn {
        display: inline-block;
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        margin-top: 15px;
        transition: all 0.3s;
      }

      .orientation-info-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      /* Modal Overlay */
      .orientation-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
      }

      .orientation-modal-content {
        background: linear-gradient(135deg, #047857 0%, #065f46 100%);
        color: white;
        margin: 10% auto;
        padding: 35px;
        border-radius: 12px;
        max-width: 650px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .orientation-modal-content h3 {
        margin-bottom: 20px;
        font-size: 1.6em;
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        padding-bottom: 10px;
      }

      .orientation-modal-content p {
        line-height: 1.8;
        font-size: 1.05em;
        margin-bottom: 15px;
      }

      .close-modal {
        color: white;
        float: right;
        font-size: 32px;
        font-weight: bold;
        cursor: pointer;
        line-height: 0.8;
        transition: all 0.2s;
      }

      .close-modal:hover {
        transform: scale(1.2);
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>JSON vs TOON Token Comparison</h1>
        <p>Compare token usage between JSON and TOON formats for LLM APIs</p>
      </div>

      <div class="controls">
        <div class="info-box">
          <strong>About this demo:</strong>
          This tool compares JSON (traditional format) vs TOON (Token Oriented
          Object Notation) to show token savings when sending financial data to
          LLMs. Demo financial data with pre-calculated ratios is automatically
          used. TOON typically saves 30-50% tokens!
        </div>

        <div class="control-row">
          <div class="control-group">
            <label for="model">Select OpenAI Model:</label>
            <select id="model">
              <option value="gpt-4o-mini">GPT-4o Mini (Cheapest)</option>
              <option value="gpt-4o">GPT-4o</option>
              <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
            </select>
          </div>

          <div class="control-group">
            <label for="apiKey">OpenAI API Key:</label>
            <input
              type="password"
              id="apiKey"
              placeholder="Enter your OpenAI API key"
            />
          </div>
        </div>

        <div class="control-row">
          <div class="control-group" style="display: none">
            <label for="dataInput">Structured Data (JSON format):</label>
            <textarea
              id="dataInput"
              placeholder="Demo financial data will be used automatically"
            ></textarea>
          </div>

          <div class="control-group" style="display: none">
            <label for="promptTemplate">Prompt Template:</label>
            <textarea
              id="promptTemplate"
              placeholder="Enter your prompt template. Use {DATA} as placeholder for the data."
            >
Analyze the following financial data and provide key insights.

            {DATA}You are a senior financial analyst. Analyse the companyâ€™s financial performance using the data I provide.

            Use the data below (in JSON or TOON format) and structure your answer under exactly these four headings (Markdown H2):

            ## 1. Revenue and Profitability
            ## 2. Balance Sheet and Financial Position
            ## 3. Cash Flow Quality
            ## 4. Key Ratios and Overall Assessment

            {DATA}</textarea
            >
          </div>
        </div>

        <div class="button-group">
          <button class="primary" onclick="compareFormats()">
            Compare Formats
          </button>
          <button class="secondary" onclick="clearResults()">
            Clear Results
          </button>
        </div>
      </div>

      <div id="loading" class="loading" style="display: none">
        Processing requests
      </div>

      <div id="error" class="error" style="display: none"></div>

      <div id="results" class="comparison-grid" style="display: none">
        <!-- Plain Language Summary Card -->
        <div class="plain-summary-card">
          <div class="plain-summary-content">
            <h3 class="plain-summary-title" onclick="togglePlainSummary()">
              <span class="collapse-icon collapsed" id="summaryCollapseIcon"
                >â–¼</span
              >
              What This Comparison Shows
            </h3>
            <p class="plain-summary-text collapsed" id="plainSummaryText">
              <!-- Dynamically populated by JavaScript -->
            </p>
          </div>
        </div>

        <!-- JSON Input Column -->
        <div class="column">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title json">JSON Format</h3>
            </div>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">Characters:</span>
                <span id="jsonChars">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Input Tokens:</span>
                <span id="jsonInputTokens">0</span>
              </div>
            </div>
            <div class="content-box" id="jsonContent"></div>
          </div>
        </div>

        <!-- TOON Input Column -->
        <div class="column">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title toon">TOON Format</h3>
            </div>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">Characters:</span>
                <span id="toonChars">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Input Tokens:</span>
                <span id="toonInputTokens">0</span>
              </div>
            </div>
            <div class="content-box" id="toonContent"></div>
          </div>
        </div>

        <!-- AI Quality Assessment Section -->
        <div class="ai-assessment">
          <h3>AI Comprehension Assessment</h3>
          <p style="color: #6c757d; margin-bottom: 20px; font-style: italic">
            From an AI's perspective: How clear and efficient is the information
            in each format?
          </p>
          <div class="ai-assessment-content">
            <div class="assessment-item json">
              <h4>JSON Format Analysis</h4>
              <div class="assessment-metric">
                <span class="assessment-label">Structure Clarity</span>
                <span
                  class="assessment-value excellent"
                  id="jsonStructureClarity"
                  >Excellent</span
                >
              </div>
              <div class="assessment-metric">
                <span class="assessment-label">Information Density</span>
                <span class="assessment-value moderate" id="jsonInfoDensity"
                  >Moderate</span
                >
              </div>
              <div class="assessment-metric">
                <span class="assessment-label">Parsing Efficiency</span>
                <span class="assessment-value good" id="jsonParsingEfficiency"
                  >Good</span
                >
              </div>
              <div class="ai-insight" id="jsonAiInsight">
                "As an AI, I find JSON highly structured and easy to parse.
                However, the repetitive key names for each record consume
                significant tokens without adding new information. The
                hierarchical structure is clear, but the verbosity makes it less
                efficient for large datasets."
              </div>
            </div>

            <div class="assessment-item toon">
              <h4>TOON Format Analysis</h4>
              <div class="assessment-metric">
                <span class="assessment-label">Structure Clarity</span>
                <span
                  class="assessment-value excellent"
                  id="toonStructureClarity"
                  >Excellent</span
                >
              </div>
              <div class="assessment-metric">
                <span class="assessment-label">Information Density</span>
                <span class="assessment-value excellent" id="toonInfoDensity"
                  >Excellent</span
                >
              </div>
              <div class="assessment-metric">
                <span class="assessment-label">Parsing Efficiency</span>
                <span
                  class="assessment-value excellent"
                  id="toonParsingEfficiency"
                  >Excellent</span
                >
              </div>
              <div class="ai-insight" id="toonAiInsight">
                "As an AI, I find TOON exceptionally efficient. The tabular
                format with column headers defined once is immediately
                comprehensible. The compact representation maintains all
                necessary information while eliminating redundancy. This format
                aligns perfectly with how I process structured data internally."
              </div>
            </div>
          </div>
        </div>

        <!-- Response Columns -->
        <div class="column">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title json">JSON Response</h3>
            </div>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">Characters:</span>
                <span id="jsonResponseChars">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Output Tokens:</span>
                <span id="jsonOutputTokens">0</span>
              </div>
            </div>
            <div class="response-box" id="jsonResponse"></div>
          </div>
        </div>

        <div class="column">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title toon">TOON Response</h3>
            </div>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">Characters:</span>
                <span id="toonResponseChars">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Output Tokens:</span>
                <span id="toonOutputTokens">0</span>
              </div>
            </div>
            <div class="response-box" id="toonResponse"></div>
          </div>
        </div>

        <!-- Summary -->
        <div class="summary">
          <h2>Token Savings Summary</h2>
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-label">
                Input Token Savings
                <span class="tooltip-icon" data-tooltip="input-savings">â“˜</span>
              </div>
              <div class="summary-value savings" id="inputSavings">0%</div>
              <div class="summary-description">
                Shows how much TOON compresses your input data compared to JSON
                format
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label">
                Output Token Difference
                <span class="tooltip-icon" data-tooltip="output-diff">â“˜</span>
              </div>
              <div class="summary-value" id="outputDiff">0</div>
              <div class="summary-description">
                AI response length varies naturally; marginal variance is common
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label">
                Total Token Savings
                <span class="tooltip-icon" data-tooltip="total-savings">â“˜</span>
              </div>
              <div class="summary-value" id="totalSavings">0</div>
              <div class="summary-description">
                Net tokens saved per request (input savings net of output
                variance)
              </div>
            </div>
            <div class="summary-item">
              <div class="summary-label">
                Total Savings %
                <span class="tooltip-icon" data-tooltip="total-savings-pct"
                  >â“˜</span
                >
              </div>
              <div class="summary-value savings" id="totalSavingsPct">0%</div>
              <div class="summary-description">
                Overall reduction across your entire request-response cycle
              </div>
            </div>
          </div>
          <div style="text-align: center">
            <button
              class="orientation-info-btn"
              onclick="showOrientationInfo()"
            >
              â“˜ Orientation Impact
            </button>
          </div>
        </div>

        <!-- Tooltip Container -->
        <div
          class="tooltip-container"
          id="tooltipContainer"
          style="display: none"
        >
          <div class="tooltip-content" id="tooltipContent"></div>
        </div>
      </div>

      <div class="footer">
        <p>
          Created for demonstrating TOON vs JSON token efficiency |
          <a
            href="https://github.com/ganapap1/toon-json-token-comparison"
            target="_blank"
            >View on GitHub</a
          >
          |
          <a href="https://pypi.org/project/toon-python/" target="_blank"
            >TOON Python Library</a
          >
        </p>
      </div>
    </div>

    <!-- Orientation Impact Modal -->
    <div id="orientationModal" class="orientation-modal">
      <div class="orientation-modal-content">
        <span class="close-modal" onclick="closeOrientationInfo()"
          >&times;</span
        >
        <h3>TOON's Smart Orientation</h3>
        <p>
          TOON adapts to your data shape. For 14 ratios Ã— 3 years, TOON uses
          ratios as columns, years as rowsâ€”saving 34% more tokens.
        </p>
        <p>
          JSON can't adapt: it repeats every key for every record (42
          repetitions). TOON lists each key once in the header, then pure
          values.
        </p>
      </div>
    </div>

    <script>
      // Model encoding configuration for OpenAI
      const modelEncodings = {
        "gpt-4o-mini": "o200k_base",
        "gpt-4o": "o200k_base",
        "gpt-3.5-turbo": "cl100k_base",
      };

      // Mock financial data with pre-calculated ratios
      function getMockFinancialData() {
        return {
          meta: {
            company_name: "Demo Company",
            currency: "USD",
            note: "Financial data for demonstration",
          },
          statements: {
            income_statement: [
              {
                "Line Item": "Total Revenue",
                2021: 14093300,
                2022: 17025000,
                2023: 14805900,
              },
              {
                "Line Item": "Total Cost of Sales",
                2021: 9603000,
                2022: 11773700,
                2023: 10258600,
              },
              {
                "Line Item": "Gross Profit",
                2021: 4490300,
                2022: 5251300,
                2023: 4547300,
              },
              {
                "Line Item": "Operating Expenses",
                2021: 2319800,
                2022: 2510600,
                2023: 2544100,
              },
              {
                "Line Item": "Net Income",
                2021: 1417400,
                2022: 1844200,
                2023: 1340100,
              },
            ],
            balance_sheet: [
              {
                "Line Item": "Cash",
                2021: 300500,
                2022: 1173400,
                2023: 1080200,
              },
              {
                "Line Item": "Inventory",
                2021: 2065000,
                2022: 1995300,
                2023: 2043200,
              },
              {
                "Line Item": "Total Assets",
                2021: 9536000,
                2022: 10329900,
                2023: 10480300,
              },
              {
                "Line Item": "Total Liabilities",
                2021: 3442300,
                2022: 3234000,
                2023: 2747500,
              },
            ],
          },
          key_ratios: [
            {
              year: "2023",
              gross_profit_margin: 30.72,
              net_profit_margin: 9.05,
              operating_margin: 13.54,
              roe: 17.33,
              roa: 12.78,
              current_ratio: 5.66,
              quick_ratio: 4.92,
              cash_ratio: 0.39,
              debt_to_equity: 0.36,
              debt_ratio: 0.26,
              interest_coverage: 15.8,
              asset_turnover: 1.41,
              inventory_turnover: 5.02,
              operating_cashflow_ratio: 2.15,
            },
            {
              year: "2022",
              gross_profit_margin: 30.84,
              net_profit_margin: 10.83,
              operating_margin: 16.08,
              roe: 23.88,
              roa: 17.86,
              current_ratio: 3.55,
              quick_ratio: 2.89,
              cash_ratio: 0.36,
              debt_to_equity: 0.42,
              debt_ratio: 0.31,
              interest_coverage: 18.2,
              asset_turnover: 1.65,
              inventory_turnover: 5.9,
              operating_cashflow_ratio: 1.98,
            },
            {
              year: "2021",
              gross_profit_margin: 31.86,
              net_profit_margin: 10.06,
              operating_margin: 15.39,
              roe: 22.97,
              roa: 14.87,
              current_ratio: 4.16,
              quick_ratio: 3.42,
              cash_ratio: 0.09,
              debt_to_equity: 0.56,
              debt_ratio: 0.36,
              interest_coverage: 16.5,
              asset_turnover: 1.48,
              inventory_turnover: 4.65,
              operating_cashflow_ratio: 2.24,
            },
          ],
        };
      }

      // Simple TOON encoder (JavaScript implementation)
      function encodeToTOON(obj, indent = 0) {
        const ind = "  ".repeat(indent);
        let result = "";

        if (Array.isArray(obj)) {
          if (
            obj.length > 0 &&
            typeof obj[0] === "object" &&
            !Array.isArray(obj[0])
          ) {
            // Array of objects - use TOON table format
            const keys = Object.keys(obj[0]);
            result += `[${obj.length},]{${keys.join(",")}}:\n`;
            obj.forEach((item) => {
              result +=
                ind +
                "  " +
                keys
                  .map((k) => {
                    const val = item[k];
                    if (typeof val === "string") return val;
                    if (val === null) return "null";
                    return val;
                  })
                  .join(",") +
                "\n";
            });
          } else {
            // Simple array
            result += "[" + obj.join(", ") + "]";
          }
        } else if (typeof obj === "object" && obj !== null) {
          for (const [key, value] of Object.entries(obj)) {
            result += ind + key + ":";
            if (typeof value === "object" && value !== null) {
              result += "\n" + encodeToTOON(value, indent + 1);
            } else {
              if (typeof value === "string") {
                result +=
                  " " +
                  (value.includes(" ") || value.includes(":")
                    ? `"${value}"`
                    : value) +
                  "\n";
              } else {
                result += " " + value + "\n";
              }
            }
          }
        }
        return result;
      }

      // Estimate token count (rough approximation)
      function estimateTokens(text) {
        // Rough estimation: ~4 characters per token on average
        // This is a simplification - actual tokenization varies by model
        return Math.ceil(text.length / 4);
      }

      async function compareFormats() {
        const model = document.getElementById("model").value;
        const apiKey = document.getElementById("apiKey").value;
        const promptTemplate = document.getElementById("promptTemplate").value;

        // Validation
        if (!apiKey) {
          showError("Please enter your OpenAI API key");
          return;
        }

        // Use demo data directly
        const data = getMockFinancialData();

        // Hide error and results, show loading
        document.getElementById("error").style.display = "none";
        document.getElementById("results").style.display = "none";
        document.getElementById("loading").style.display = "block";

        try {
          // Format data
          const jsonData = JSON.stringify(data, null, 2);
          const toonData = encodeToTOON(data);

          // Build prompts
          const jsonPrompt = promptTemplate.replace(
            "{DATA}",
            "```json\n" + jsonData + "\n```"
          );
          const toonPrompt = promptTemplate.replace("{DATA}", toonData);

          // Display formatted data
          document.getElementById("jsonContent").innerHTML = `<pre>${escapeHtml(
            jsonData
          )}</pre>`;
          document.getElementById("toonContent").innerHTML = `<pre>${escapeHtml(
            toonData
          )}</pre>`;

          document.getElementById("jsonChars").textContent =
            jsonPrompt.length.toLocaleString();
          document.getElementById("toonChars").textContent =
            toonPrompt.length.toLocaleString();

          // Make API calls to OpenAI
          const [jsonResult, toonResult] = await Promise.all([
            callOpenAI(apiKey, model, jsonPrompt),
            callOpenAI(apiKey, model, toonPrompt),
          ]);

          // Display results
          displayResults(jsonResult, toonResult);
        } catch (error) {
          showError("Error: " + error.message);
        } finally {
          document.getElementById("loading").style.display = "none";
        }
      }

      async function callOpenAI(apiKey, model, prompt) {
        const response = await fetch(
          "https://api.openai.com/v1/chat/completions",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${apiKey}`,
            },
            body: JSON.stringify({
              model: model,
              messages: [{ role: "user", content: prompt }],
              temperature: 0.7,
              max_tokens: 2000,
              top_p: 0.9,
            }),
          }
        );

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error?.message || "API request failed");
        }

        const data = await response.json();
        return {
          content: data.choices[0].message.content,
          inputTokens: data.usage.prompt_tokens,
          outputTokens: data.usage.completion_tokens,
          totalTokens: data.usage.total_tokens,
        };
      }

      // Tooltip Data Configuration
      const tooltipData = {
        "input-savings": {
          title: "Input Token Savings %",
          content: "", // Will be dynamically populated with calculation
          isDynamic: true,
        },
        "output-diff": {
          title: "Output Token Difference",
          content: "", // Will be dynamically populated with calculation
          isDynamic: true,
        },
        "total-savings": {
          title: "Total Token Savings",
          content: "", // Will be dynamically populated
          isDynamic: true,
        },
        "total-savings-pct": {
          title: "Total Savings %",
          content: `
            <p>Your overall token reduction across the entire request-response cycle.</p>
            <p><strong>Why it's lower than input %:</strong> This includes both input (highly compressed) and output (uncompressedâ€”the AI responds the same way regardless of input format).</p>
            <p class="tooltip-range">Typically 15-25% for full cycle</p>
          `,
        },
      };

      // Function to update dynamic tooltip content
      function updateDynamicTooltips(jsonResult, toonResult) {
        console.log(
          "Tooltip update",
          jsonResult.inputTokens,
          toonResult.inputTokens
        );
        const inputSavings = jsonResult.inputTokens - toonResult.inputTokens;
        const inputSavingsPct = (
          (inputSavings / jsonResult.inputTokens) *
          100
        ).toFixed(2);
        const outputDiff = jsonResult.outputTokens - toonResult.outputTokens;

        // Update Input Token Savings tooltip with calculation
        tooltipData["input-savings"].content = `
          <p><strong>Calculation:</strong></p>
          <p>JSON Input Tokens: ${jsonResult.inputTokens.toLocaleString()}<br>
          TOON Input Tokens: ${toonResult.inputTokens.toLocaleString()}<br>
          Net Savings: ${inputSavings.toLocaleString()} tokens</p>
          <p>${inputSavings.toLocaleString()} Ã· ${jsonResult.inputTokens.toLocaleString()} = ${inputSavingsPct}%</p>
          <p><strong>Why it matters:</strong> Input tokens are what you pay for when sending data to LLMs. This percentage directly translates to cost savings.</p>
          <p class="tooltip-range">Expected range: 30-50% for structured datasets</p>
        `;

        // Update Output Token Difference tooltip with calculation
        tooltipData["output-diff"].content = `
          <p><strong>Calculation:</strong></p>
          <p>JSON Output Tokens: ${jsonResult.outputTokens.toLocaleString()}<br>
          TOON Output Tokens: ${toonResult.outputTokens.toLocaleString()}<br>
          Difference: ${outputDiff.toLocaleString()} tokens</p>
          <p><strong>Why variance is normal:</strong> Both formats receive identical instructions, so the AI generates essentially the same response. Small differences occur naturally due to the non-deterministic nature of language models (typically 5-10% variation). This marginal variance doesn't affect the value of input token compression.</p>
          <p class="tooltip-range">Typical range: -200 to +200 tokens</p>
        `;

        // Update Total Token Savings tooltip with dynamic wording
        const totalSavings = jsonResult.totalTokens - toonResult.totalTokens;
        let savingsExplanation;

        if (outputDiff > 0) {
          // Output also saved tokens
          savingsExplanation = `Input token savings (${inputSavings.toLocaleString()}) plus output token savings (${outputDiff.toLocaleString()}) = ${totalSavings.toLocaleString()} total tokens saved.`;
        } else if (outputDiff < 0) {
          // Output used more tokens
          savingsExplanation = `Input token savings (${inputSavings.toLocaleString()}) net of output variance (${Math.abs(
            outputDiff
          ).toLocaleString()}) = ${totalSavings.toLocaleString()} total tokens saved.`;
        } else {
          // Output same
          savingsExplanation = `Input token savings (${inputSavings.toLocaleString()}) with identical output = ${totalSavings.toLocaleString()} total tokens saved.`;
        }

        tooltipData["total-savings"].content = `
          <p><strong>Calculation:</strong></p>
          <p>${savingsExplanation}</p>
          <p><strong>Calculate your impact:</strong> Multiply this number by your monthly request volume to see total token savings. For example, ${totalSavings.toLocaleString()} tokens Ã— 10,000 requests = ${(
          totalSavings * 10000
        ).toLocaleString()} tokens saved monthly.</p>
          <p class="tooltip-range">Scales with your data size</p>
        `;
      }

      // Tooltip Event Handlers
      let tooltipsInitialized = false;

      function setupTooltips() {
        if (tooltipsInitialized) return; // Prevent duplicate initialization

        const tooltipIcons = document.querySelectorAll(".tooltip-icon");
        const tooltipContainer = document.getElementById("tooltipContainer");
        const tooltipContent = document.getElementById("tooltipContent");

        if (tooltipIcons.length === 0) return; // No icons found, exit

        tooltipIcons.forEach((icon) => {
          // Mouse enter - show tooltip
          icon.addEventListener("mouseenter", function (e) {
            const tooltipKey = this.getAttribute("data-tooltip");
            const data = tooltipData[tooltipKey];
            console.log(
              "Hovering over tooltip:",
              tooltipKey,
              "Content length:",
              data?.content?.length
            );

            if (data) {
              tooltipContent.innerHTML = `<strong>${data.title}</strong>${data.content}`;
              tooltipContainer.style.display = "block";
              tooltipContainer.style.opacity = "1";
              tooltipContainer.style.visibility = "visible";
              positionTooltip(e, tooltipContainer);
              console.log("Tooltip should be visible now", {
                display: tooltipContainer.style.display,
                position:
                  tooltipContainer.style.left +
                  ", " +
                  tooltipContainer.style.top,
                content: tooltipContent.innerHTML.substring(0, 50),
              });
            }
          });

          // Mouse move - update position
          icon.addEventListener("mousemove", function (e) {
            positionTooltip(e, tooltipContainer);
          });

          // Mouse leave - hide tooltip
          icon.addEventListener("mouseleave", function () {
            tooltipContainer.style.display = "none";
          });

          // Mobile tap support
          icon.addEventListener("click", function (e) {
            e.preventDefault();
            const tooltipKey = this.getAttribute("data-tooltip");
            const data = tooltipData[tooltipKey];

            if (data) {
              // Toggle tooltip on mobile
              if (tooltipContainer.style.display === "block") {
                tooltipContainer.style.display = "none";
              } else {
                tooltipContent.innerHTML = `<strong>${data.title}</strong>${data.content}`;
                tooltipContainer.style.display = "block";
                positionTooltip(e, tooltipContainer);
              }
            }
          });
        });

        // Close tooltip when clicking outside on mobile
        document.addEventListener("click", function (e) {
          if (
            !e.target.closest(".tooltip-icon") &&
            !e.target.closest(".tooltip-container")
          ) {
            tooltipContainer.style.display = "none";
          }
        });

        tooltipsInitialized = true;
        console.log("Tooltips initialized successfully");
      }

      function positionTooltip(event, tooltipElement) {
        const padding = 10;
        const tooltipRect = tooltipElement.getBoundingClientRect();

        // Use clientX/clientY for fixed positioning (relative to viewport, not page)
        let left = event.clientX + padding;
        let top = event.clientY + padding;

        // Adjust if tooltip goes off right edge
        if (left + tooltipRect.width > window.innerWidth) {
          left = event.clientX - tooltipRect.width - padding;
        }

        // Adjust if tooltip goes off bottom edge
        if (top + tooltipRect.height > window.innerHeight) {
          top = event.clientY - tooltipRect.height - padding;
        }

        tooltipElement.style.left = left + "px";
        tooltipElement.style.top = top + "px";
      }

      // Generate Plain Language Summary
      function generatePlainSummary(jsonResult, toonResult) {
        const inputSavings = jsonResult.inputTokens - toonResult.inputTokens;
        const inputSavingsPct = (
          (inputSavings / jsonResult.inputTokens) *
          100
        ).toFixed(2);
        const totalSavings = jsonResult.totalTokens - toonResult.totalTokens;
        const totalSavingsPct = (
          (totalSavings / jsonResult.totalTokens) *
          100
        ).toFixed(2);
        const outputDiff = jsonResult.outputTokens - toonResult.outputTokens;

        // Opening summary
        let summaryText = `TOON reduces your input data by <span class="plain-summary-highlight">${inputSavingsPct}%</span>, `;

        if (totalSavings > 0) {
          summaryText += `saving <span class="plain-summary-highlight">${totalSavings.toLocaleString()} tokens total</span> per request (${totalSavingsPct}% overall). `;
        } else {
          summaryText += `with a net total of <span class="plain-summary-highlight">${totalSavings.toLocaleString()} tokens</span> per request (${totalSavingsPct}% overall). `;
        }

        if (Math.abs(outputDiff) < 50) {
          summaryText += `Output lengths are nearly identical, showing consistent AI responses across both formats.`;
        } else if (outputDiff > 0) {
          summaryText += `The AI response was slightly shorter with TOON, adding to your savings.`;
        } else {
          summaryText += `Output length varies slightly due to natural AI response patternsâ€”this doesn't reflect format efficiency.`;
        }

        // Add comprehensive explanation section
        summaryText += `<br><br><strong>How TOON Achieves These Savings:</strong><br>`;
        summaryText += `TOON uses a <span class="plain-summary-highlight">tabular format</span> that eliminates repetitive JSON keys. `;
        summaryText += `When you send arrays of objects in JSON, each object repeats the same keys (e.g., "name", "age", "city"). `;
        summaryText += `TOON declares these keys once as headers, then lists only the valuesâ€”similar to how spreadsheets work. `;

        // Show breakdown to clarify the difference between input savings and total savings
        if (outputDiff > 0) {
          summaryText += `For your dataset, this header-only-once pattern eliminated <span class="plain-summary-highlight">${inputSavings.toLocaleString()} redundant tokens (input savings)</span>, and the AI response was ${outputDiff.toLocaleString()} tokens shorter, for a combined total of ${totalSavings.toLocaleString()} tokens saved.`;
        } else if (outputDiff < 0) {
          summaryText += `For your dataset, this header-only-once pattern eliminated <span class="plain-summary-highlight">${inputSavings.toLocaleString()} redundant tokens (input savings)</span>. The total savings of ${totalSavings.toLocaleString()} tokens reflects the ${inputSavings.toLocaleString()} input savings minus ${Math.abs(
            outputDiff
          ).toLocaleString()} output variance.`;
        } else {
          summaryText += `For your dataset, this header-only-once pattern eliminated <span class="plain-summary-highlight">${inputSavings.toLocaleString()} redundant tokens (input savings)</span>, with identical output for a total of ${totalSavings.toLocaleString()} tokens saved.`;
        }

        // Add cost impact calculation with realistic pricing
        summaryText += `<br><br><strong>Your Cost Impact:</strong><br>`;

        // Calculate cost savings for GPT-4o Mini ($0.15 / 1M tokens)
        const miniCost1k = ((inputSavings * 1000 * 0.15) / 1000000).toFixed(2);
        const miniCost10k = ((inputSavings * 10000 * 0.15) / 1000000).toFixed(
          2
        );
        const miniCost100k = ((inputSavings * 100000 * 0.15) / 1000000).toFixed(
          2
        );

        // Calculate cost savings for GPT-4o ($2.50 / 1M tokens)
        const gpt4oCost1k = ((inputSavings * 1000 * 2.5) / 1000000).toFixed(2);
        const gpt4oCost10k = ((inputSavings * 10000 * 2.5) / 1000000).toFixed(
          2
        );
        const gpt4oCost100k = ((inputSavings * 100000 * 2.5) / 1000000).toFixed(
          2
        );

        summaryText += `<table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.95em;">`;
        summaryText += `<thead><tr style="border-bottom: 2px solid #047857;">`;
        summaryText += `<th style="text-align: left; padding: 8px; color: #047857;">Volume</th>`;
        summaryText += `<th style="text-align: center; padding: 8px; color: #047857;">Tokens Saved</th>`;
        summaryText += `<th style="text-align: right; padding: 8px; color: #047857;">GPT-4o Mini</th>`;
        summaryText += `<th style="text-align: right; padding: 8px; color: #047857;">GPT-4o</th>`;
        summaryText += `</tr></thead><tbody>`;

        summaryText += `<tr style="border-bottom: 1px solid rgba(4, 120, 87, 0.2);">`;
        summaryText += `<td style="padding: 8px;">1,000 requests/month</td>`;
        summaryText += `<td style="text-align: center; padding: 8px;"><span class="plain-summary-highlight">${(
          inputSavings * 1000
        ).toLocaleString()}</span></td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${miniCost1k}</td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${gpt4oCost1k}</td>`;
        summaryText += `</tr>`;

        summaryText += `<tr style="border-bottom: 1px solid rgba(4, 120, 87, 0.2);">`;
        summaryText += `<td style="padding: 8px;">10,000 requests/month</td>`;
        summaryText += `<td style="text-align: center; padding: 8px;"><span class="plain-summary-highlight">${(
          inputSavings * 10000
        ).toLocaleString()}</span></td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${miniCost10k}</td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${gpt4oCost10k}</td>`;
        summaryText += `</tr>`;

        summaryText += `<tr>`;
        summaryText += `<td style="padding: 8px;">100,000 requests/month</td>`;
        summaryText += `<td style="text-align: center; padding: 8px;"><span class="plain-summary-highlight">${(
          inputSavings * 100000
        ).toLocaleString()}</span></td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${miniCost100k}</td>`;
        summaryText += `<td style="text-align: right; padding: 8px; color: #4ade80; font-weight: 600;">$${gpt4oCost100k}</td>`;
        summaryText += `</tr>`;

        summaryText += `</tbody></table>`;

        summaryText += `<br><em style="font-size: 0.9em; opacity: 0.85; font-style: italic;">Based on input token savings only. Pricing: GPT-4o Mini $0.15/1M tokens | GPT-4o $2.50/1M tokens</em>`;

        return summaryText;
      }

      function displayResults(jsonResult, toonResult) {
        // Update token counts
        document.getElementById("jsonInputTokens").textContent =
          jsonResult.inputTokens.toLocaleString();
        document.getElementById("jsonOutputTokens").textContent =
          jsonResult.outputTokens.toLocaleString();
        document.getElementById("toonInputTokens").textContent =
          toonResult.inputTokens.toLocaleString();
        document.getElementById("toonOutputTokens").textContent =
          toonResult.outputTokens.toLocaleString();

        // Update character counts for responses
        document.getElementById("jsonResponseChars").textContent =
          jsonResult.content.length.toLocaleString();
        document.getElementById("toonResponseChars").textContent =
          toonResult.content.length.toLocaleString();

        // Render markdown responses
        document.getElementById("jsonResponse").innerHTML = marked.parse(
          jsonResult.content
        );
        document.getElementById("toonResponse").innerHTML = marked.parse(
          toonResult.content
        );

        // Update AI Assessment
        updateAIAssessment(jsonResult, toonResult);

        // Calculate savings
        const inputSavings = jsonResult.inputTokens - toonResult.inputTokens;
        const inputSavingsPct = (
          (inputSavings / jsonResult.inputTokens) *
          100
        ).toFixed(2);

        const outputDiff = jsonResult.outputTokens - toonResult.outputTokens;

        const totalSavings = jsonResult.totalTokens - toonResult.totalTokens;
        const totalSavingsPct = (
          (totalSavings / jsonResult.totalTokens) *
          100
        ).toFixed(2);

        // Update Plain Summary Card
        const plainSummaryText = generatePlainSummary(jsonResult, toonResult);
        document.getElementById("plainSummaryText").innerHTML =
          plainSummaryText;

        // Update Input Savings (always positive for TOON)
        document.getElementById("inputSavings").textContent =
          inputSavingsPct + "%";
        document.getElementById("inputSavings").className =
          "summary-value savings";

        // Update Output Difference with context and color
        const outputDiffElement = document.getElementById("outputDiff");
        if (outputDiff === 0) {
          outputDiffElement.textContent = "0";
          outputDiffElement.className = "summary-value neutral";
        } else {
          outputDiffElement.innerHTML = `${outputDiff.toLocaleString()}<span class="value-context">(AI variance)</span>`;
          outputDiffElement.className = "summary-value amber";
        }

        // Update Total Savings with color coding
        const totalSavingsElement = document.getElementById("totalSavings");
        totalSavingsElement.textContent = totalSavings.toLocaleString();
        if (totalSavings > 0) {
          totalSavingsElement.className = "summary-value positive";
        } else if (totalSavings < 0) {
          totalSavingsElement.className = "summary-value negative";
        } else {
          totalSavingsElement.className = "summary-value neutral";
        }

        // Update Total Savings % with color coding
        const totalSavingsPctElement =
          document.getElementById("totalSavingsPct");
        totalSavingsPctElement.textContent = totalSavingsPct + "%";
        if (parseFloat(totalSavingsPct) > 0) {
          totalSavingsPctElement.className = "summary-value savings";
        } else if (parseFloat(totalSavingsPct) < 0) {
          totalSavingsPctElement.className = "summary-value negative";
        } else {
          totalSavingsPctElement.className = "summary-value neutral";
        }

        // Update dynamic tooltip content with actual values FIRST
        updateDynamicTooltips(jsonResult, toonResult);

        // Show results
        document.getElementById("results").style.display = "grid";

        // Initialize tooltips after results are visible
        setTimeout(() => setupTooltips(), 100);

        // Scroll to results
        document
          .getElementById("results")
          .scrollIntoView({ behavior: "smooth", block: "start" });
      }

      function updateAIAssessment(jsonResult, toonResult) {
        // Calculate efficiency metrics
        const inputSavingsPct =
          ((jsonResult.inputTokens - toonResult.inputTokens) /
            jsonResult.inputTokens) *
          100;

        // JSON Assessment (static - JSON is always moderately efficient)
        document.getElementById("jsonStructureClarity").textContent =
          "Excellent";
        document.getElementById("jsonStructureClarity").className =
          "assessment-value excellent";

        document.getElementById("jsonInfoDensity").textContent = "Moderate";
        document.getElementById("jsonInfoDensity").className =
          "assessment-value moderate";

        document.getElementById("jsonParsingEfficiency").textContent = "Good";
        document.getElementById("jsonParsingEfficiency").className =
          "assessment-value good";

        // Dynamic JSON insight based on data size
        const jsonDataSize = jsonResult.inputTokens;
        let jsonInsight = "";

        if (jsonDataSize > 2000) {
          jsonInsight =
            '"As an AI, I find JSON highly structured and easy to parse. However, for this dataset, the repetitive key names for each record consume significant tokens without adding new information. The hierarchical structure is clear, but the verbosity creates substantial overhead for large datasets like this one."';
        } else if (jsonDataSize > 500) {
          jsonInsight =
            '"As an AI, I find JSON well-structured and straightforward to parse. The explicit key-value pairs are clear, though the repetition of field names for each record adds unnecessary tokens. For datasets of this size, the verbosity becomes noticeable."';
        } else {
          jsonInsight =
            '"As an AI, I find JSON highly readable and structured. For small datasets like this, the verbose format is acceptable, though it still includes redundant key names that could be optimized."';
        }

        document.getElementById("jsonAiInsight").textContent = jsonInsight;

        // TOON Assessment (always excellent for structured data)
        document.getElementById("toonStructureClarity").textContent =
          "Excellent";
        document.getElementById("toonStructureClarity").className =
          "assessment-value excellent";

        document.getElementById("toonInfoDensity").textContent = "Excellent";
        document.getElementById("toonInfoDensity").className =
          "assessment-value excellent";

        document.getElementById("toonParsingEfficiency").textContent =
          "Excellent";
        document.getElementById("toonParsingEfficiency").className =
          "assessment-value excellent";

        // Dynamic TOON insight based on savings
        let toonInsight = "";

        if (inputSavingsPct > 45) {
          toonInsight = `"As an AI, I find TOON exceptionally efficient. The tabular format with column headers defined once is immediately comprehensible. This representation achieved ${inputSavingsPct.toFixed(
            1
          )}% token reduction while maintaining perfect information fidelity. The compact structure aligns perfectly with how I process structured data internally."`;
        } else if (inputSavingsPct > 30) {
          toonInsight = `"As an AI, I find TOON highly efficient. The table-based format eliminates redundancy while preserving all necessary information. With ${inputSavingsPct.toFixed(
            1
          )}% fewer tokens, this format is significantly more efficient while remaining equally comprehensible to me."`;
        } else {
          toonInsight = `"As an AI, I find TOON efficient and well-structured. The compact representation maintains clarity while reducing token usage by ${inputSavingsPct.toFixed(
            1
          )}%. The format is particularly effective for tabular data with repeated structures."`;
        }

        document.getElementById("toonAiInsight").textContent = toonInsight;
      }

      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
        document.getElementById("loading").style.display = "none";
      }

      function clearResults() {
        document.getElementById("results").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("dataLoadStatus").style.display = "none";
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Orientation Impact Modal Functions
      function togglePlainSummary() {
        const summaryText = document.getElementById("plainSummaryText");
        const collapseIcon = document.getElementById("summaryCollapseIcon");

        summaryText.classList.toggle("collapsed");
        collapseIcon.classList.toggle("collapsed");
      }

      function showOrientationInfo() {
        document.getElementById("orientationModal").style.display = "block";
      }

      function closeOrientationInfo() {
        document.getElementById("orientationModal").style.display = "none";
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("orientationModal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </body>
</html>
